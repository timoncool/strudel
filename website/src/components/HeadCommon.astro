---
// @ts-ignore
import { pwaInfo } from 'virtual:pwa-info';
import '../styles/index.css';

const { BASE_URL } = import.meta.env;
const baseNoTrailing = BASE_URL.endsWith('/') ? BASE_URL.slice(0, -1) : BASE_URL;
---

<!-- Global Metadata -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width" />
<meta name="generator" content={Astro.generator} />
<link rel="alternate" type="application/rss+xml" title={`RSS Feed for Bulka`} href="/rss.xml" />
<link rel="icon" type="image/svg+xml" href={`${baseNoTrailing}/favicon.svg`} />

<!-- Fredoka Font for Bulka branding -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@500;700&display=swap" rel="stylesheet" />

<!-- Iconify for noto:bread icon -->
<script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>

<meta
  name="description"
  content="Bulka — платформа для лайв-кодинга музыки в браузере."
/>
<link rel="icon" href={`${baseNoTrailing}/favicon.svg`} />
<link rel="apple-touch-icon" href={`${baseNoTrailing}/icons/apple-icon-180.png`} sizes="180x180" />
<meta name="theme-color" content="#222222" />

<base href={BASE_URL} />

<!-- Scrollable a11y code helper -->
<script {`${baseNoTrailing}/make-scrollable-code-focusable.js`} is:inline></script>

<script src="/src/pwa.ts"></script>
<!-- this does not work for some reason: -->
<!-- <style is:global define:vars={strudelTheme}></style> -->
<!-- the following variables are just a fallback to make sure everything is readable without JS -->
<style is:global>
  :root {
    --background: #222;
    --lineBackground: #22222299;
    --foreground: #fff;
    --caret: #ffcc00;
    --selection: rgba(128, 203, 196, 0.5);
    --selectionMatch: #036dd626;
    --lineHighlight: #00000050;
    --gutterBackground: transparent;
    --gutterForeground: #8a919966;
  }
</style>
{pwaInfo && <Fragment set:html={pwaInfo.webManifest.linkTag} />}

<script>
  import { initTheme, codemirrorSettings } from '@strudel/codemirror';

  initTheme(codemirrorSettings.get().theme);

  // https://medium.com/quick-code/100vh-problem-with-ios-safari-92ab23c852a8
  const appHeight = () => {
    const doc = document.documentElement;
    doc.style.setProperty('--app-height', `${window.innerHeight - 1}px`);
  };
  if (typeof window !== 'undefined') {
    window.addEventListener('resize', appHeight);
    appHeight();
  }
</script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105793195', 'ym');

    ym(105793195, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105793195" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
