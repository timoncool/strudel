import{j as e}from"./jsx-runtime.CLpGMVip.js";import{r as o}from"./index.B9mnsnPE.js";import{e as G,n as U,_ as Y}from"./index.CXEd7qFE.js";import{g as J}from"./index.Ds4Xb5JZ.js";import{S as K,w as Q}from"./codemirror.CljggVKv.js";import{i as X,w as Z,g as ee}from"./spectrum.DtTj66Yt.js";import{p as te,b as re,s as oe}from"./prebake.Cdsm-3G8.js";import{C as ie}from"./Claviature.JqbZtIpN.js";import"./_commonjsHelpers.BosuxZz1.js";import"./preload-helper.CLcXU_4U.js";/* empty css                      */function u({type:i}){return i==="skip"?e.jsx("svg",{fillRule:"evenodd",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",height:"16",width:"10",viewBox:"0 0 320 512",children:e.jsx("path",{d:"M52.5 440.6c-9.5 7.9-22.8 9.7-34.1 4.4S0 428.4 0 416V96C0 83.6 7.2 72.3 18.4 67s24.5-3.6 34.1 4.4l192 160L256 241V96c0-17.7 14.3-32 32-32s32 14.3 32 32V416c0 17.7-14.3 32-32 32s-32-14.3-32-32V271l-11.5 9.6-192 160z"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:{refresh:e.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"}),play:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"}),pause:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"}),stop:e.jsx("path",{fillRule:"evenodd",d:"M2 10a8 8 0 1116 0 8 8 0 01-16 0zm5-2.25A.75.75 0 017.75 7h4.5a.75.75 0 01.75.75v4.5a.75.75 0 01-.75.75h-4.5a.75.75 0 01-.75-.75v-4.5z",clipRule:"evenodd"}),skip:e.jsx("path",{fillRule:"evenodd",d:"M52.5 440.6c-9.5 7.9-22.8 9.7-34.1 4.4S0 428.4 0 416V96C0 83.6 7.2 72.3 18.4 67s24.5-3.6 34.1 4.4l192 160L256 241V96c0-17.7 14.3-32 32-32s32 14.3 32 32V416c0 17.7-14.3 32-32 32s-32-14.3-32-32V271l-11.5 9.6-192 160z",clipRule:"evenodd"})}[i]})}function se(){const[i,s]=o.useState(!1);return o.useEffect(()=>{s(!0)},[]),i}let M,N,S;typeof window<"u"&&(M=te(),N=re(),S=X());function Ce({tune:i,tunes:s,hideHeader:H=!1,canvasHeight:z=100,onTrigger:m,punchcard:a,punchcardLabels:V=!0,claviature:d,claviatureLabels:A,maxHeight:x,autodraw:f,drawTime:c,mondo:I=!1}){const v=s?s[0]:i,g=o.useMemo(()=>ne(),[]),b=!!a,p=b?o.useMemo(()=>`canvas-${g}`,[g]):null;f=!!a||!!d||!!f,c=c??a?[0,4]:[-2,2],d&&(c=[0,0]);const[B,D]=o.useState([]),E=o.useCallback(({code:t,autodraw:W})=>{const _=p?document.querySelector("#"+p)?.getContext("2d"):J(),k=new K({id:g,defaultOutput:Z,getTime:()=>ee().currentTime,transpiler:Q,autodraw:W,root:w.current,initialCode:"// LOADING",pattern:G,drawTime:c,drawContext:_,editPattern:(r,le)=>(m&&(r=r.onTrigger(m,!1)),d&&(r=r.onPaint((ae,de,$,ce)=>{const q=$.map(l=>l.value.note).filter(Boolean).map(l=>typeof l=="string"?U(l):l);D(q)})),a&&(r=r.punchcard({labels:!!V})),r),prebake:async()=>Promise.all([N,M]),onUpdateState:r=>{O({...r})},onToggle:r=>{},beforeStart:()=>S,afterEval:({code:r})=>oe(r),mondo:I});k.setCode(t),n.current=k},[]),[L,O]=o.useState({}),{started:h,isDirty:T,error:j}=L,n=o.useRef(),w=o.useRef(),P=se(),[C,F]=o.useState(0),y=t=>{t=Y(t,s.length),F(t),n.current?.setCode(s[t]),n.current?.evaluate()};return P?e.jsxs("div",{className:"overflow-hidden rounded-t-md bg-background border border-lineHighlight",children:[!H&&e.jsxs("div",{className:"flex justify-between bg-lineHighlight",children:[e.jsxs("div",{className:"flex",children:[e.jsx("button",{className:R("cursor-pointer w-16 flex items-center justify-center p-1 border-r border-lineHighlight text-foreground bg-lineHighlight hover:bg-background",h?"animate-pulse":""),"aria-label":h?"stop":"play",onClick:()=>n.current?.toggle(),children:e.jsx(u,{type:h?"stop":"play"})}),e.jsx("button",{className:R("w-16 flex items-center justify-center p-1 text-foreground border-lineHighlight bg-lineHighlight",T?"text-foreground hover:bg-background cursor-pointer":"opacity-50 cursor-not-allowed"),"aria-label":"update",onClick:()=>n.current?.evaluate(),children:e.jsx(u,{type:"refresh"})})]}),s&&e.jsxs("div",{className:"flex",children:[e.jsx("button",{className:"cursor-pointer w-16 flex items-center justify-center p-1 border-r border-lineHighlight text-foreground bg-lineHighlight hover:bg-background","aria-label":"previous example",onClick:()=>y(C-1),children:e.jsx("div",{className:"rotate-180",children:e.jsx(u,{type:"skip"})})}),e.jsx("button",{className:"cursor-pointer w-16 flex items-center justify-center p-1 border-r border-lineHighlight text-foreground bg-lineHighlight hover:bg-background","aria-label":"next example",onClick:()=>y(C+1),children:e.jsx(u,{type:"skip"})})]})]}),e.jsxs("div",{className:"overflow-auto relative p-1",style:x?{maxHeight:`${x}px`}:{},children:[e.jsx("div",{ref:t=>{n.current||(w.current=t,E({code:v,autodraw:f}))}}),j&&e.jsx("div",{className:"text-right p-1 text-md text-red-200",children:j.message})]}),b&&e.jsx("canvas",{id:p,className:"w-full pointer-events-none border-t border-lineHighlight",height:z,ref:t=>{t&&t.width!==t.clientWidth&&(t.width=t.clientWidth)}}),d&&e.jsx(ie,{options:{range:["C2","C6"],scaleY:.75,colorize:[{keys:B,color:"steelblue"}],labels:A||{}}})]}):e.jsx("pre",{children:v})}function R(...i){return i.filter(Boolean).join(" ")}function ne(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}export{Ce as MiniRepl};
