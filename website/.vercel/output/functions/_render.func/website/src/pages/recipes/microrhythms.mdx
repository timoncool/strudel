---
title: Microrhythms
layout: ../../layouts/MainLayout.astro
---

import { MiniRepl } from '../../docs/MiniRepl';

смотрите https://strudel.cc/?zMEo5kowGrFc

# Microrhythms

Вдохновлённые этой [Мини-лекцией о нотации Microrhythm](https://www.youtube.com/watch?v=or7B6vI3jOo), давайте посмотрим, как мы можем выразить microrhythms с помощью Strudel.

Временные метки первого ритма - `0 1/5 1/2 2/3 1`. Мы могли бы наивно выразить это с помощью stack:

<MiniRepl
  client:idle
  tune={`s("hh").struct(
  stack(
    "x", // 0
    "~ x ~@3", // 1/5
    "~ x", // 1/2
    "~@2 x" // 2/3
))`}
/>

Хотя это работает, у этого есть две проблемы:

- это не очень компактно
- длительности неправильные, например, первая нота занимает весь cycle

В видео длительность временной метки вычисляется путём вычитания её из следующей временной метки:

- 1/5 - 0 = 1/5 = 6/30
- 1/2 - 1/5 = 3/10 = 9/30
- 2/3 - 1/2 = 1/6 = 5/30
- 1 - 2/3 = 1/3 = 10/30

Используя их, мы теперь можем выразить ритм гораздо короче:

<MiniRepl client:idle tune={`s("hh").struct("x@6 x@9 x@5 x@10")`} />

Проблемы первой нотации теперь исправлены: она гораздо короче, и длительности правильные.
Тем не менее, эта нотация требовала вычисления длительностей вручную, что можно автоматизировать:

<MiniRepl
  client:idle
  tune={`Pattern.prototype.micro = function (...timestamps) {
  const durations = timestamps.map((x, i, a) => {
    const next = i < a.length-1 ? a[i+1] : 1;
    return next - a[i]
  })
  return this.struct(timeCat(...durations.map(d => [d, 1]))).late(timestamps[0])
}
s('hh').micro(0, 1/5, 1/2, 2/3)`}
/>

Эта нотация ещё короче, и она позволяет напрямую вводить временные метки!

Это второй пример из видео:

<MiniRepl
  client:idle
  tune={`Pattern.prototype.micro = function (...timestamps) {
  const durations = timestamps.map((x, i, a) => {
    const next = i < a.length-1 ? a[i+1] : 1;
    return next - a[i]
  })
  return this.struct(timeCat(...durations.map(d => [d, 1]))).late(timestamps[0])
}
s('hh').micro(0, 1/6, 2/5, 2/3, 3/4)`}
/>

с басом: https://strudel.cc/?sTglgJJCPIeY
