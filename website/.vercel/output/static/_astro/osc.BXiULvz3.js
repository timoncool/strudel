import{c as f,p as l,i as g,n as v,l as a,C as m}from"./index.CXEd7qFE.js";let c;function w(){return c||(c=new Promise((n,o)=>{const t=new WebSocket("ws://localhost:8080");t.addEventListener("open",s=>{a("[osc] websocket connected"),n(t)}),t.addEventListener("close",s=>{a("[osc] websocket closed"),c=void 0,console.log("[osc] disconnected"),o("OSC connection closed")}),t.addEventListener("error",s=>o(s))}).catch(n=>{throw c=void 0,new Error("Could not connect to OSC server. Is it running?")})),c}function O(n,o){n.ensureObjectValue();const t=n.wholeOrPart().begin.valueOf(),s=n.duration.valueOf()/o,e=Object.assign({},{cps:o,cycle:t,delta:s},n.value);e.n&&(e.n=l(e.n)),typeof e.note<"u"&&(g(e.note)?e.midinote=v(e.note,e.octave||3):e.note=l(e.note)),e.bank&&(e.s=e.bank+e.s),e.roomsize&&(e.size=l(e.roomsize)),e.unit==="c"&&e.speed!=null&&(e.speed=e.speed/o);const r=e.channels;return r!=null&&(e.channels=JSON.stringify(r)),e}const b=new m({});async function p(n,o,t=1,s){const e=await w(),r=O(n,t),d=Object.entries(r).flat(),u=b.calculateTimestamp(o,s)*1e3,i={address:"/dirt/play",args:d,timestamp:u};"oschost"in n.value&&(i.host=n.value.oschost),"oscport"in n.value&&(i.port=n.value.oscport),e.send(JSON.stringify(i))}const y=f("osc",n=>n.onTrigger(p));export{y as osc,p as oscTrigger,O as parseControlsFromHap};
